"""
==========
V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY IDR Export (Auto-Generated)
==========

Auto-generated IDROutputter implementation for IDRC_PRD.CMS_VDM_VIEW_MDCR_PRD.V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY

Table Type: VIEW
Columns: 13
Generated: 2025-11-04 00:46:08
Source Pattern: %PRVDR_ENRLMT%

This script provides a complete IDROutputter subclass that exports all columns
from the table in their original Snowflake order. You can customize the
getSelectQuery() method to add WHERE clauses, JOINs, or modify column selection.

Usage:
    # In a Snowflake notebook environment:
    exporter = V2PrvdrEnrlmtPrctcLctnCliaHstryExporter()
    exporter.do_idr_output()
"""

# Import python packages
import pandas as pd
from datetime import datetime

# Import the IDROutputter base class
try:
    from IDROutputter import IDROutputter
except ImportError:
    print("Loading IDROutputter from previous cell or add proper import path")


class V2PrvdrEnrlmtPrctcLctnCliaHstryExporter(IDROutputter):
    """
    Exports V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY data using IDROutputter base class.
    
    Auto-generated from table metadata. Customize as needed for your specific requirements.
    
    Table: IDRC_PRD.CMS_VDM_VIEW_MDCR_PRD.V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY (VIEW)
    Columns: 13
    """
    
    # Class properties
    version_number: str = "v01"
    file_name_stub: str = "v2_prvdr_enrlmt_prctc_lctn_clia_hstry_idr_export"
    
    def getSelectQuery(self) -> str:
        """
        Returns the SELECT query for V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY export.
        
        Includes all 13 columns in their original Snowflake order.
        Customize this method to add WHERE clauses, JOINs, or modify column selection.
        """
        return """SELECT
                PRVDR_ENRLMT_ID, -- TEXT(15): A UNIQUE VALUE GENERATED BY THE PROVIDER ENROLLMENT, CHAIN AND OWNERSHIP SYSTEM (PECOS) TO IDENTIFY A PROVIDER'S ENROLLMENT APPLICATION. ALL ENROLLMENT-LEVEL INFORMATION (E.G., ENROLLMENT TYPE, ENROLLMENT STATE, PROVIDER SPECIALTY AND REASSIGNMENT OF BENEFITS) IS LINKED THROUGH THE ENROLLMENT ID.
                PRCTC_LCTN_SK, -- NUMBER(20): UNIQUE NUMBER GENERATED BY PROVIDER ENROLLMENT, CHAIN AND OWNERSHIP SYSTEM (PECOS) TO MAKE THE PRACTICE LOCATION ROW UNIQUE.
                CLIA_ID, -- TEXT(15): THE PROVIDERâ€™S CERTIFICATION NUMBER UNDER CLIA (CLINICAL LABORATORY IMPROVEMENT AMENDMENTS OF 1988). PROVIDERS MUST BE ACCREDITED BY A CMS-APPROVED ACCREDITATION ORGANIZATION IF THEY PERFORM CLINICAL LAB TESTS. CLIA NUMBERS CAN BE ISSUED TO AN INDIVIDUAL PRACTICING PHYSICIAN/PROVIDER FOR LAB WORK PERFORMED IN HIS/HER OFFICE; OR THE NUMBER CAN BE ASSIGNED TO A GROUP, CLINIC, OR FACILITY (AND ALL PHYSICIANS/PRACTITIONERS WITHIN THAT ORGANIZATION WOULD USE THE SAME CLIA NUMBER).
ACCORDING TO CMS DOCUMENTATION, CLIA REQUIRES ALL ENTITIES THAT PERFORM EVEN ONE TEST, INCLUDING WAIVED TESTS ON ... 'MATERIALS DERIVED FROM THE HUMAN BODY FOR THE PURPOSE OF PROVIDING INFORMATION FOR THE DIAGNOSIS, PREVENTION OR TREATMENT OF ANY DISEASE OR IMPAIRMENT OF, OR THE ASSESSMENT OF THE HEALTH OF, HUMAN BEINGS' TO MEET CERTAIN FEDERAL REQUIREMENTS. IF AN ENTITY PERFORMS TESTS FOR THESE PURPOSES, IT IS CONSIDERED UNDER CLIA TO BE A LABORATORY AND MUST REGISTER WITH THE CLIA PROGRAM. THIS REQUIREMENT EXTENDS TO INDIVIDUAL PHYSICIANS WHO PERFORM TESTS IN THEIR OFFICES, AS WELL AS TO LABORATORIES, RADIOLOGISTS, FACILITIES, ETC. 

                IDR_DRVD_PRCTC_LCTN_CLIA_EFCTV_DT, -- DATE: A DATE IDENTIFYING THE EFFECTIVE DATE FOR THIS VERSION OF THE CLINICAL LABORATORY IMPROVEMENT AMENDMENTS (CLIA) PRACTICE LOCATION ADDRESS.
                IDR_TRANS_EFCTV_TS, -- TIMESTAMP_NTZ: THE SYSTEM DATE AND TIME ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) IDENTIFYING WHEN A RECORD WAS LOADED.
                IDR_TRANS_OBSLT_TS, -- TIMESTAMP_NTZ: THE SYSTEM DATE AND TIME ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) IDENTIFYING WHEN A RECORD WAS LAST KNOWN TO BE PRESENT IN THE SOURCE. THE CURRENT VERSION OF A RECORD WILL BE SET TO 12/31/9999 00:00:00.
                IDR_LTST_TRANS_FLG, -- TEXT(1): AN INDICATOR ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) THAT IDENTIFIES WHICH TRANSACTION RECORD, BASED ON PRIMARY KEY, IS CONSIDERED TO REPRESENT THE MOST RECENT RECORD RECEIVED FROM THE SOURCE.

VALID VALUES:
Y = LATEST VERSION OF THE RECORD
N = PREVIOUS VERSION OF THE RECORD
                PRCTC_LCTN_CLIA_TRMNTN_DT, -- DATE: A DATE IDENTIFYING THE END DATE FOR THIS VERSION OF THE CLINICAL LABORATORY IMPROVEMENT AMENDMENTS (CLIA) PRACTICE LOCATION ADDRESS.
                IDR_INSRT_TS, -- TIMESTAMP_NTZ: THE SYSTEM DATE AND TIME ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) WHILE PERFORMING AN INSERT OPERATION.
                IDR_UPDT_TS, -- TIMESTAMP_NTZ: THE SYSTEM DATE AND TIME ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) WHEN UPDATES ARE MADE TO ANY NON-PRIMARY KEY COLUMN.
                META_SRC_SK, -- NUMBER(38): A UNIQUE NUMERIC VALUE ASSIGNED BY THE INTEGRATED DATA REPOSITORY (IDR) USED TO IDENTIFY THE SPECIFIC SOURCE OF THE DATA WHEN A ROW IS LOADED INTO THE IDR.REFERENCE TABLE: V2_MDCR_META_DCTNRY_SRC
                META_SRC_PRCSG_ID, -- NUMBER(38): A VALUE ASSIGNED BASED ON A BATCH IDENTIFICATION IN ORDER TO TRACE IT BACK TO ITS ORIGINAL SOURCE. IT WILL ONLY BE POPULATED WHEN A RECORD IS INSERTED.
                META_LTST_SRC_PRCSG_ID -- NUMBER(38): A VALUE ASSIGNED BASED ON A BATCH IDENTIFICATION IN ORDER TO TRACE IT BACK TO ITS ORIGINAL SOURCE. IT WILL ONLY BE POPULATED WHEN A RECORD IS SUBSEQUENTLY UPDATED.
            FROM IDRC_PRD.CMS_VDM_VIEW_MDCR_PRD.V2_PRVDR_ENRLMT_PRCTC_LCTN_CLIA_HSTRY"""


if __name__ == '__main__':
    # Execute the export using the IDROutputter framework
    exporter = V2PrvdrEnrlmtPrctcLctnCliaHstryExporter()
    exporter.do_idr_output()

# To download use: 
# snowsql -c cms_idr -q "GET @~/ file://. PATTERN='.*.csv';"
# Or look in ../misc_scripts/ for download_and_merge_all_snowflake_csv.sh
